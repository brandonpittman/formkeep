#!/usr/bin/env ruby

require 'formkeep'
require 'slop'

opts = Slop.parse do
  banner "Usage: formkeep unread FORM"
  on :h, :help, "Display help"
  on :v, :version, "Display version" do
    puts Formkeep::VERSION
    exit
  end

  command 'unread' do
    banner <<-EOF
    Usage: formkeep unread FORM

    Please make sure you have a valid Formkeep API endpoint saved in ~/.formkeep.yaml
    EOF
    on :s, :sticky, "Create sticky notification"
    run do |opts, args|
      unless args.empty?
        form = Formkeep::Form.new(args[0])
        count = form.unread_submissions.length
        puts count
        form.sticky(count.to_s) if opts[:s]
      else
        puts opts
      end
    end
  end
end

puts opts unless ARGV[0] == 'unread'
